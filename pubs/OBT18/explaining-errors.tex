% -*- compile-command: "pdflatex explaining-errors.tex" -*-

%% For double-blind review submission, w/o CCS and ACM Reference (max submission space)
%\documentclass[sigplan,review,anonymous]{acmart}\settopmatter{printfolios=true,printccs=false,printacmref=false}
%% For double-blind review submission, w/ CCS and ACM Reference
%\documentclass[sigplan,review,anonymous]{acmart}\settopmatter{printfolios=true}
%% For single-blind review submission, w/o CCS and ACM Reference (max submission space)
%\documentclass[sigplan,review]{acmart}\settopmatter{printfolios=true,printccs=false,printacmref=false}
%% For single-blind review submission, w/ CCS and ACM Reference
%\documentclass[sigplan,review]{acmart}\settopmatter{printfolios=true}
%% For final camera-ready submission, w/ required CCS and ACM Reference
\documentclass[sigplan, screen]{acmart}\settopmatter{printccs=false,printacmref=false}


% https://tex.stackexchange.com/questions/346292/remove-conference-information-from-acm-2017-sigconf-template
\settopmatter{printacmref=false} % Removes citation information below abstract
\renewcommand\footnotetextcopyrightpermission[1]{} % removes footnote with conference information in first column
\pagestyle{plain} % removes running headers

\setcopyright{none}

%% Bibliography style
\bibliographystyle{ACM-Reference-Format}
%% Citation style
\citestyle{acmauthoryear}   %% For author/year citations
%\citestyle{acmnumeric}     %% For numeric citations
%\setcitestyle{nosort}      %% With 'acmnumeric', to disable automatic
                            %% sorting of references within a single citation;
                            %% e.g., \cite{Smith99,Carpenter05,Baker12}
                            %% rendered as [14,5,2] rather than [2,5,14].
%\setcitesyle{nocompress}   %% With 'acmnumeric', to disable automatic
                            %% compression of sequential references within a
                            %% single citation;
                            %% e.g., \cite{Baker12,Baker14,Baker16}
                            %% rendered as [2,3,4] rather than [2-4].

%% Some recommended packages.
\usepackage{booktabs}   %% For formal tables:
                        %% http://ctan.org/pkg/booktabs
\usepackage{subcaption} %% For complex figures with subfigures/subcaptions
                        %% http://ctan.org/pkg/subcaption


\begin{document}

\title{Explaining Type Errors}

%% Author with single affiliation.
\author{Brent A. Yorgey}
\affiliation{
  \institution{Hendrix College}
}
\email{yorgey@hendrix.edu}

\author{Richard A. Eisenberg}
\affiliation{
  \institution{Bryn Mawr College}
}
\email{rae@cs.brynmawr.edu}

\author{Harley D. Eades III}
\affiliation{
  \institution{Augusta University}
}
\email{heades@augusta.edu}

% %% Keywords
% \keywords{keyword1, keyword2, keyword3}


%% \maketitle
%% Note: \maketitle command must come after title commands, author
%% commands, abstract environment, Computing Classification System
%% environment and commands, and keywords command.
\maketitle

Every beginning student of programming---that is, every student with
the ill fortune of having a language with a static type system foisted
upon them by a well-intentioned yet sadistic instructor---is
well-acquainted with the Dreaded Type Error Message:

\begin{verbatim}
<interactive>:1:33: error:
  Couldn't match expected type (t, b0) with actual type Int
  In the first argument of fst, namely p
    In the expression: fst p
    In the first argument of \ f -> f (3 :: Int), namely
      (\ p -> fst p)
\end{verbatim}

Why do type error messages have to be so terrifying?  Can't we do a
better job explaining type errors to programmers?

We propose two interrelated theses:
\begin{enumerate}
\item We ought to move away from static error ``messages'' and towards
  interactive \emph{error explanations}.
\item We ought to consider the problem of generating error
  explanations in a more systematic, disciplined, and formal way.
  Explaining errors to users shouldn't just be relegated to the status
  of an ``engineering issue'', but ought to have all the tools of
  programming language theory and practice applied to it.
\end{enumerate}

\section{An example}

Consider a standard version of the simply typed lambda calculus, with
typing annotations on lambda-bound variables.

XXX show heart of typical 


\section{It's the Interactivity, Stupid}

Much work in this space has focused on one of two things: rephrasing
error messages to use less technical jargon, and/or including more
potentially helpful information such as contextual information or
suggested fixes.  Rephrasing error messages is well and good, but
doesn't go nearly far enough in and of itself.  When an error message
is generated from somewhere deep inside a typechecking algorithm,
beginning programmers are liable to have no idea where it comes from
no matter how nicely it is phrased.  The solution, it would seem, is
to include more contextual information, suggestions, and the like, to
help the programmer understand where the error comes from and what
their options are.  This is a natural impulse, but can sometimes be
counterproductive: beginning programmers are likely to be intimidated
by a twenty-line error message, even if the only reason it is twenty
lines long is because it is stuffed full of helpful information.

XXX could put example here of ``helpful'' GHC error message, though
that might just take up too much space

The real problem is that we are stuck thinking of type checking in a
terminal-based, batch processing mode.  If the programmer is allowed
to explore error messages interactively, we can have the best of both
worlds: they can be initially presented with a concise, easy-to-read
message, and then 





When there is a valid type for some program, how do we explain it?  We all know the answer to this: a typing derivation can be seen as a detailed explanation/justification of why some term has some type.  Make type checking/inference return an entire derivation rather than just a type.

When a program *doesn't* type check, how do we explain it?  I propose the answer should be: with an untyping derivation!  That is, a constructive proof/evidence for untypability.  We can extract information from this to show to the user, or (ideally) let them interactively explore it.

How do we know what the right definition of untyping derivations is?  Simple: we know we've "gotten it right" when we can prove a metatheorem showing that there is an untyping derivation if and only if there is not a typing derivation (or maybe we only want one direction if the type system is sufficiently undecidable??).  At this point I can pull out a simple example I've coded up in Agda, with typing and untyping derivations for the STLC, plus a formal metatheorem relating them.  (In practice, I didn't get the definition of untyping proofs right the first time: I had to adjust it when my proof didn't go though!  A triumph for machine-checked formalism.)

Something about history and natural deduction blah blah, the natural-deduction style proofs we use for typing derivations just so happen to correspond very nicely to the way humans want to reason/think about things, and all the thinking can be done "locally".  Unfortunately this seems to go out the window when we bring in things like unification, because it is inherently nonlocal.

I have a few thoughts about ways to design systems with unification to make them more explainable.  One of the main thoughts is that using a union-find data structure is not just for speed---it's also much more explainable!  Humans don't want to think in terms of transitive chains of equalities or in terms of (shudder) substitutions.  If the name of a thing keeps changing during the course of an explanation, a human is going to get very confused.  Instead we can keep the names of things the same and just accumulate sets of names which are all equal.  I also have some thoughts on using "extensional" names instead of/in addition to fresh ones (e.g. using a name like "the argument type of f" instead of "a0" or whatever).

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%% Acknowledgments
\begin{acks}                            %% acks environment is optional
                                        %% contents suppressed with 'anonymous'
  %% Commands \grantsponsor{<sponsorID>}{<name>}{<url>} and
  %% \grantnum[<url>]{<sponsorID>}{<number>} should be used to
  %% acknowledge financial support and will be used by metadata
  %% extraction tools.
  This material is based upon work supported by the
  \grantsponsor{GS100000001}{National Science
    Foundation}{http://dx.doi.org/10.13039/100000001} under Grant
  No.~\grantnum{GS100000001}{nnnnnnn} and Grant
  No.~\grantnum{GS100000001}{mmmmmmm}.  Any opinions, findings, and
  conclusions or recommendations expressed in this material are those
  of the author and do not necessarily reflect the views of the
  National Science Foundation.
\end{acks}


%% Bibliography
%\bibliography{bibfile}


\end{document}
